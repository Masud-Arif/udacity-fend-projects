<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Neighborhood Map | FEND Projects</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- build:css styles.css -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <!-- endbuild -->

    <!-- Google Maps initialization callback. -->
    <script>
      // Variable used to access the initialized map and services.
      var _map;

      // Initialize the Google map.
      function initMap() {
        var storageKeys = {
              MAPOPTIONS: 'mapOptions'
            },
            defaults = {
              mapOptions: {
                center: {lat: 40.77073903483321, lng: -73.97455215454102},  // New York, US.
                zoom: 12,
                disableDoubleClickZoom: true
              }
            },
            searchBoxID = 'places-search';

        var mapOptions = JSON.parse(localStorage.getItem(storageKeys.MAPOPTIONS)) || defaults.mapOptions,
            inputElem = document.getElementById(searchBoxID);

        _map = {};

        // Initialize the map.
        _map.map = new google.maps.Map(document.getElementById('map'), mapOptions);

        // Initialize the places service.
        _map.places = new google.maps.places.PlacesService(_map.map);

        // Initialize the places search box.
        _map.searchBox = new google.maps.places.SearchBox(inputElem);

        // Add the search box to the map controls.
        _map.map.controls[google.maps.ControlPosition.TOP_LEFT].push(inputElem);

        // Bias the search box results towards the map's viewport.
        _map.map.addListener('bounds_changed', function() {
          _map.searchBox.setBounds(_map.map.getBounds());
        });

        // Initialize the info window.
        _map.infoWindow = new google.maps.InfoWindow();
      }
    </script>

    <!-- Google Maps API and Places library. -->
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFjYsMLSna2dvG5DIL-zXcXRQs5-UY-Zs&libraries=places&callback=initMap"></script>
    <!-- UUID generator. -->
    <script async src="bower_components/uuid.js/dist/uuid.core.js"></script>
    <!-- jQuery (used by placeInfo.js). -->
    <script async src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>

    <!-- App-specific scripts. -->
    <!-- build:js scripts.js async -->
    <script async src="js/placeInfo.js"></script>
    <script async src="js/map.js"></script>
    <script async src="js/components/info-window.js"></script>
    <script async src="js/models/folder.js"></script>
    <script async src="js/models/marker.js"></script>
    <script async src="js/viewmodels/sidebar.js"></script>
    <script async src="js/viewmodels/markersForm.js"></script>
    <script async src="js/viewmodels/main.js"></script>
    <script async src="js/app.js"></script>
    <!-- endbuild -->

    <!-- Google Analytics. -->
    <!-- <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72597920-3', 'auto');
      ga('send', 'pageview');
    </script> -->
  </head>
  <body>
    <header class="sidebar" data-bind="css: {expanded: sidebar.expanded}">
      <div class="sidebar-content">
        <fieldset>
          <legend>Map Marker Filters</legend>
          <input type="text" placeholder="Search Markers" data-bind="textInput: sidebar.search">
          <label><input type="checkbox" data-bind="checked: sidebar.visibleOnly">Visible Only</label>
        </fieldset>
        <ul class="marker-list" data-bind="template: { name: 'listTemplate', foreach: markers }">
        </ul>
        <form data-bind="submit: sidebar.addFolder">
          <input data-bind="textInput: sidebar.newFolderName" type="text" placeholder="New Folder">
        </form>
      </div>
    </header>

    <main>
      <button class="sidebar-toggle" data-bind="click: sidebar.toggle"><img src="image/sidebar-button.svg" height="20" width="20" alt="Toggle"></button>
      <input id="places-search" type="text" placeholder="Search">
      <div id="map"></div>
      <form data-bind="visible: markersForm.visible">
        <fieldset>
          <legend>Pending Map Markers</legend>
          <!-- ko foreach: markersForm.pending -->
          <div class="pending-marker">
            <input class="add-marker" type="checkbox" data-bind="checked: confirmed">
            <span data-bind="text: marker.title"></span>
          </div>
          <!-- /ko -->
        </fieldset>
        <button type="button" data-bind="click: markersForm.cancel">Cancel</button>
        <button type="button" data-bind="click: markersForm.submit">Confirm</button>
      </form>
    </main>

    <!-- Templates. -->

    <!-- List template. -->
    <script type="text/html" id="listTemplate">
      <li data-bind="visible: visible, dragZone: {
                                         name: 'sortable',
                                         dragStart: $root.sidebar.dragStart,
                                         dragEnd: $root.sidebar.dragEnd,
                                         data: { items: $parent.contents || $parent.markers, item: $data }
                                       },
                                       dragEvents: {
                                         accepts: 'sortable',
                                         dragOver: $root.sidebar.reorder,
                                         data: { items: $parent.contents || $parent.markers, item: $data }
                                       }">
        <span class="drag-handle">=</span>
        <!-- ko if: $data.contents -->
        <button data-bind="click: $root.sidebar.toggleFolder">v</button>
        <input data-bind="visible: editing, value: name, hasFocus: editing">
        <span data-bind="text: name, click: $root.sidebar.modifyFolder, visible:!editing()"></span>
        <button data-bind="click: $root.sidebar.removeFolder">x</button>
        <button data-bind="click: $root.sidebar.centerOnContents">o</button>
        <ul data-bind="template: { name: 'listTemplate', foreach: contents }">
        </ul>
        <!-- /ko -->
        <!-- ko ifnot: $data.contents -->
        <span data-bind="text:title, click: $root.sidebar.markerClicked"></span>
        <!-- /ko -->
      </li>
    </script>


    <!-- Knockout. Must be loaded before Knockout-dragdrop. -->
    <script src="bower_components/knockout/dist/knockout.js"></script>
    <!-- Knockout-dragdrop. Must be loaded after Knockout. -->
    <script async src="bower_components/knockout-dragdrop/lib/knockout.dragdrop.js"></script>
  </body>
</html>
