!function(){function e(e){e instanceof Array?e.forEach(function(e){t(e)}):t(e)}function t(e){if(a[e])return a[e];var t=new Image;t.onload=function(){a[e]=t,n()&&s.forEach(function(e){e()})},a[e]=!1,t.src=e}function i(e){return a[e]}function n(){var e=!0;for(var t in a)a.hasOwnProperty(t)&&!a[t]&&(e=!1);return e}function o(e){s.push(e)}var a={},s=[];window.Resources={load:e,get:i,onReady:o,isReady:n}}(),function(e){function t(e,t){return t[1]<e[0]?-1:t[0]>e[1]?1:0}function i(e,t){return Math.floor(Math.random()*(t-e+1))+e}function n(t){try{var i=e.window[t],n="__storage_test__";return i.setItem(n,n),i.removeItem(n),!0}catch(o){return!1}}e.util={compareRanges:t,randomFromRange:i,storageAvailable:n}}(this);var Engine=function(e){function t(){var e=Date.now(),i=(e-l)/1e3;n(i),a(),l=e,c.requestAnimationFrame(t)}function i(){r(),l=Date.now(),t()}function n(e){o(e)}function o(e){allEnemies.forEach(function(t){t.update(e)}),player.update(e),allCollectables.forEach(function(t){t.update(e)})}function a(){u.clearRect(0,0,d.width,d.height);for(var e in menus)if(menus[e].active)return void drawMenu(e);var t,i,n=["images/water-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/grass-block.png","images/grass-block.png"],o=6,a=5;for(t=0;t<o;t++)for(i=0;i<a;i++)u.drawImage(Resources.get(n[t]),101*i,83*t);drawScore(),drawLives(),drawLevel(),allCollectables.forEach(function(e){e.render()}),s()}function s(){allEnemies.forEach(function(e){e.render()}),player.render()}function r(){}var l,h=e.document,c=e.window,d=h.createElement("canvas"),u=d.getContext("2d");d.width=505,d.height=606,h.getElementsByTagName("main")[0].appendChild(d),Resources.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/char-boy.png","images/Gem Blue.png","images/Gem Green.png","images/Gem Orange.png","images/Heart.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png"]),Resources.onReady(i),e.ctx=u}(this);!function(e){function t(){F.save(),F.font="20px serif",F.textAlign="center",F.textBaseline="alphabetic",F.fillText("Level - "+j.level,252.5,45),F.restore()}function i(){for(var e=0,t=0,i=j.lives;t<i;t++)F.drawImage(Y.get("images/Heart.png"),e,10,25,43),e+=30}function n(e){"start"===e?s():"scores"===e&&a()}function o(){F.save(),F.font="24px serif",F.textAlign="end",F.textBaseline="alphabetic",F.fillText("Score: "+j.score,505,45),F.restore()}function a(){F.save();var e;F.lineWidth=1,F.strokeStyle="#000",F.fillStyle="#f5f5f5",F.fillRect(0,6,B.width,B.height-6),F.strokeRect(1,6,B.width-2,B.height-7),F.fillStyle="#393",F.shadowOffsetX=2,F.shadowOffsetY=2,F.shadowBlur=2,F.shadowColor="rgba(51, 153, 51, 0.3)",F.font="38px serif",F.textAlign="center",F.textBaseline="alphabetic",F.fillText("Your High Scores",(B.width-2)/2,60),F.shadowOffsetX=1,F.shadowOffsetY=1,F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeStyle="#666",F.fillStyle="#fafafa",F.strokeRect(20,80,B.width-40,B.height-80-80-20),F.fillRect(20,80,B.width-40,B.height-80-80-20),F.shadowColor="rgba(0, 0, 0, 0.0)",F.textBaseline="alphabetic";for(var t=B.height-80-80-20,i=B.width-40,n=0,o=W.length;n<20&&n<o;n++){var a=0,s=n%10;n>=10&&(a=1),F.textAlign="end",F.font="16px serif",F.fillStyle="#666",F.fillText("#"+(n+1)+":",60+Math.floor(i/2)*a,105+Math.floor((t-35)/9)*s),F.textAlign="start",F.font="20px Courier",F.fillStyle="#333",F.fillText(W[n].amount,65+Math.floor(i/2)*a,105+Math.floor((t-35)/9)*s),F.font="14px Courier",F.fillStyle="#777",F.fillText("level "+W[n].level,135+Math.floor(i/2)*a,105+Math.floor((t-35)/9)*s)}e=H.scores.buttons["continue"].pressed?"#ddd":H.scores.buttons["continue"].hovered?"#e7e7e7":"#fafafa",F.fillStyle=e,F.strokeStyle="#666",F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeRect((B.width-2)/2-70,B.height-80,140,40),F.fillRect((B.width-2)/2-70,B.height-80,140,40),F.shadowColor="rgba(0, 0, 0, 0)",F.fillStyle="#393",F.font="24px serif",F.textAlign="center",F.textBaseline="middle",F.fillText("Continue",(B.width-2)/2,B.height-60),F.restore()}function s(){F.save();var e;F.lineWidth=1,F.strokeStyle="#000",F.fillStyle="#f5f5f5",F.fillRect(0,6,B.width,B.height-6),F.strokeRect(1,6,B.width-2,B.height-7),F.fillStyle="#393",F.shadowOffsetX=2,F.shadowOffsetY=2,F.shadowBlur=2,F.shadowColor="rgba(51, 153, 51, 0.3)",F.font="38px serif",F.textAlign="center",F.textBaseline="alphabetic",F.fillText("Escape By Water!",(B.width-2)/2,86),F.shadowOffsetX=1,F.shadowOffsetY=1,F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeStyle="#666",F.fillStyle="#fafafa",F.strokeRect((B.width-2)/2-50,186,101,141),F.fillRect((B.width-2)/2-50,186,101,141),F.shadowColor="rgba(0, 0, 0, 0)",F.drawImage(Y.get(N.playerSprite),(B.width-2)/2-50,156),e=H.start.buttons.left.pressed?"#ddd":H.start.buttons.left.hovered?"#e7e7e7":"#fafafa",F.fillStyle=e,F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeRect((B.width-2)/2-50-20,337,65,30),F.fillRect((B.width-2)/2-50-20,337,65,30),F.strokeStyle="#000",F.shadowColor="rgba(0, 0, 0, 0)",F.beginPath(),F.moveTo((B.width-2)/2-50-20+45,352),F.lineTo((B.width-2)/2-50-20+20,352),F.lineTo((B.width-2)/2-50-20+30,347),F.moveTo((B.width-2)/2-50-20+20,352),F.lineTo((B.width-2)/2-50-20+30,357),F.stroke(),e=H.start.buttons.right.pressed?"#ddd":H.start.buttons.right.hovered?"#e7e7e7":"#fafafa",F.fillStyle=e,F.strokeStyle="#666",F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeRect((B.width-2)/2+5,337,65,30),F.fillRect((B.width-2)/2+5,337,65,30),F.strokeStyle="#000",F.shadowColor="rgba(0, 0, 0, 0)",F.beginPath(),F.moveTo((B.width-2)/2+5+20,352),F.lineTo((B.width-2)/2+5+45,352),F.lineTo((B.width-2)/2+5+35,347),F.moveTo((B.width-2)/2+5+45,352),F.lineTo((B.width-2)/2+5+35,357),F.stroke(),e=H.start.buttons.play.pressed?"#ddd":H.start.buttons.play.hovered?"#e7e7e7":"#fafafa",F.fillStyle=e,F.strokeStyle="#666",F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeRect((B.width-2)/2-50,B.height-120,100,40),F.fillRect((B.width-2)/2-50,B.height-120,100,40),F.shadowColor="rgba(0, 0, 0, 0)",F.fillStyle="#393",F.font="24px serif",F.textAlign="center",F.textBaseline="middle",F.fillText("Play",(B.width-2)/2,B.height-100),e=H.start.buttons.issues.pressed?"#ddd":H.start.buttons.issues.hovered?"#e7e7e7":"#fafafa",F.fillStyle=e,F.strokeStyle="#666",F.shadowColor="rgba(0, 0, 0, 0.3)",F.strokeRect(10,B.height-30,20,20),F.fillRect(10,B.height-30,20,20),F.beginPath(),F.arc(20,B.height-20,5,0,Math.PI,!0),F.lineTo(15,B.height-18),F.arc(20,B.height-18,5,Math.PI,0,!0),F.lineTo(25,B.height-20),F.fillStyle="#111",F.shadowColor="rgba(0, 0, 0, 0)",F.fill(),F.moveTo(17,B.height-24),F.lineTo(15,B.height-27),F.moveTo(23,B.height-24),F.lineTo(25,B.height-27),F.moveTo(15,B.height-19),F.lineTo(12,B.height-19),F.moveTo(25,B.height-19),F.lineTo(28,B.height-19),F.moveTo(16,B.height-16),F.lineTo(13,B.height-15),F.moveTo(24,B.height-16),F.lineTo(27,B.height-15),F.stroke(),F.restore()}function r(){A(),H.scores.active=!0,_.length=0,D.length=0}function l(){if(O.AudioContext){L=new O.AudioContext;for(var e in X)X[e].mediaElementSource=L.createMediaElementSource(X[e].audio)}M=new U,W=R()}function h(){var e=z.indexOf(N.playerSprite);++e>=z.length&&(e=0),N.playerSprite=z[e]}function c(e){G||b();var t={37:"left",65:"left",38:"up",87:"up",39:"right",68:"right",40:"down",83:"down"};M.handleInput(t[e.keyCode])}function d(e){for(var t in H)if(H[t].active)for(var i in H[t].buttons)i=H[t].buttons[i],i.pressed=!1,i.hovered&&(i.pressed=!0)}function u(e){var t=B.getBoundingClientRect();for(var i in H)if(H[i].active)for(var n in H[i].buttons){n=H[i].buttons[n];var o=e.clientX-t.left,a=e.clientY-t.top;n.hovered=!1,o>n.x&&o<=n.x+n.width&&a>n.y&&a<=n.y+n.height&&(n.hovered=!0),n.hovered||(n.pressed=!1)}}function f(e){for(var t in H)if(H[t].active)for(var i in H[t].buttons)i=H[t].buttons[i],i.hovered&&i.pressed&&(i.pressed=!1,w("buttonPress"),i.action())}function g(e){function t(t){if(e.target===B){var i=e.changedTouches[0].pageX-e.target.offsetLeft,n=e.changedTouches[0].pageY-e.target.offsetTop;for(var o in H[t].buttons)o=H[t].buttons[o],o.hovered&&(i>o.x&&i<=o.x+o.width&&n>o.y&&n<=o.y+o.height&&(w("buttonPress"),o.action()),o.hovered=o.pressed=!1)}else for(var a in H[t].buttons)H[t].buttons[a].hovered=!1,H[t].buttons[a].pressed=!1}function i(){var t,i=B.getBoundingClientRect(),n=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,a=i.left+M.x+50,s=i.top+M.y+124,r=50.5;Math.abs(n-a)>Math.abs(o-s)?n>a+r?t="right":n<a-r&&(t="left"):o>s+r?t="down":o<s-r&&(t="up"),M.handleInput(t)}e.preventDefault(),G||b();var n=!1;for(var o in H)H[o].active&&(n=!0,t(o));n||i()}function p(e){function t(t){if(e.target===B){var i=e.changedTouches[0].pageX-e.target.offsetLeft,n=e.changedTouches[0].pageY-e.target.offsetTop;for(var o in H[t].buttons)o=H[t].buttons[o],i>o.x&&i<=o.x+o.width&&n>o.y&&n<=o.y+o.height&&(o.hovered=o.pressed=!0)}}for(var i in H)H[i].active&&t(i)}function m(){O.open("https://github.com/Tempurturtul/udacity-fend-projects/issues","_blank")}function v(){for(var e in H)H[e].active=!1;x()}function w(e){X[e]&&(e=X[e],e.audio.currentTime=0,e.audio.volume=.01,e.audio.play(),L&&e.mediaElementSource.connect(L.destination))}function y(){var e=z.indexOf(N.playerSprite);--e<0&&(e=z.length-1),N.playerSprite=z[e]}function b(){for(var e in X){var t=X[e].audio;t.volume=0,t.play()}G=!0}function x(){j.numEnemies=j.original.numEnemies,j.enemySpeedRange=j.original.enemySpeedRange,j.newEnemyLevel=j.original.newEnemyLevel,j.lives=3,j.level=1,j.score=0,E(),k(),M.reset()}function S(){for(var e in H)"start"===e?H[e].active=!0:H[e].active=!1;x()}function R(){if(I.storageAvailable("localStorage")){var e=JSON.parse(O.localStorage.getItem("scores"))||[];return e}return console.warn("Unable to retrieve high scores; local storage is unavailable."),[]}function T(){I.storageAvailable("localStorage")?O.localStorage.setItem("scores",JSON.stringify(W)):console.warn("High scores not saved; local storage is unavailable.")}function k(){D.length=0;for(var e=0,t=j.numCollectables;e<t;e++){var i=new K;D.push(i)}}function E(){_.length=0;for(var e=0,t=j.numEnemies;e<t;e++){var i=new q;_.push(i)}}function C(){var e=j.enemySpeedRange,t=200,i=500,n=5,o=20;e[0]=e[0]+n>t?t:e[0]+n,e[1]=e[1]+o>i?i:e[1]+o,j.enemySpeedRange=e;var a=5,s=j.newEnemyLevel;if(j.numEnemies<a&&j.level===s){_.push(new q),j.numEnemies++;var r=2*s,l=s+30;j.newEnemyLevel=Math.min(r,l)}}function A(){W.push({amount:j.score,level:j.level}),W=W.sort(function(e,t){return e.amount<t.amount?1:e.amount>t.amount?-1:0}),T()}var L,M,O=e.window,P=e.document,B=P.getElementsByTagName("canvas")[0],I=e.util,F=e.ctx,Y=e.Resources,X={died:{audio:new Audio("sounds/died.wav"),mediaElementSource:null},won:{audio:new Audio("sounds/won.wav"),mediaElementSource:null},collectablePickup:{audio:new Audio("sounds/collectable-pickup.wav"),mediaElementSource:null},buttonPress:{audio:new Audio("sounds/button-press.wav"),mediaElementSource:null}},G=!1,_=[],D=[],W=[],j={lives:3,level:1,score:0,numEnemies:2,enemySpeedRange:[130,300],newEnemyLevel:5,numCollectables:3,original:{lives:3,level:1,score:0,numEnemies:2,enemySpeedRange:[130,300],newEnemyLevel:5,numCollectables:3}},z=["images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png"],H={start:{active:!0,buttons:{left:{x:(B.width-2)/2-50-20,y:337,width:65,height:30,hovered:!1,pressed:!1,action:y},right:{x:(B.width-2)/2+5,y:337,width:65,height:30,hovered:!1,pressed:!1,action:h},play:{x:(B.width-2)/2-50,y:B.height-120,width:100,height:40,hovered:!1,pressed:!1,action:v},issues:{x:10,y:B.height-30,width:20,height:20,hovered:!1,pressed:!1,action:m}}},scores:{active:!1,buttons:{"continue":{x:(B.width-2)/2-70,y:B.height-80,width:140,height:40,hovered:!1,pressed:!1,action:S}}}},N={playerSprite:z[0]},J=function(e,t,i){this.sprite=e,this.x=t,this.y=i,this.render=function(){F.drawImage(Y.get(this.sprite),this.x,this.y)}},q=function(){function e(){var e=I.randomFromRange(j.enemySpeedRange[0],j.enemySpeedRange[1]);return e=Math.max(Math.round(e*I.randomFromRange(50,100)*.01),j.enemySpeedRange[0])}var t="images/enemy-bug.png",i=I.randomFromRange(0,404),n=83*I.randomFromRange(1,3)-25;J.call(this,t,i,n),this.speed=e(),this.update=function(t){this.x+=this.speed*t,this.x>=505&&(this.x=-101,this.y=83*I.randomFromRange(1,3)-25,this.speed=e()),this.handleCollisions()},this.handleCollisions=function(){M.suspended||this.y===M.y&&this.x+50.5>M.x&&this.x-101/1.5<M.x&&M.die()}};q.prototype=Object.create(J.prototype),q.prototype.constructor=q;var U=function(){var e=N.playerSprite,t=202,i=390;J.call(this,e,t,i),this.scale=1,this.opacity=1,this.suspended=!1,this.animations={win:{isPlaying:!1},death:{isPlaying:!1}},this.update=function(e){for(var t in this.animations)if(this.animations[t].isPlaying)switch(t){case"win":this.winAnimation(e);break;case"death":this.deathAnimation(e)}this.handleCollisions()},this.render=function(){F.save(),F.globalAlpha=this.opacity,F.drawImage(Y.get(this.sprite),this.x+(50-50*this.scale),this.y+(121-121*this.scale),101*this.scale,171*this.scale),F.restore()},this.handleCollisions=function(){!this.suspended&&this.y<=-25&&this.win()},this.handleInput=function(e){if(!this.suspended){for(var t in H)if(H[t].active)return;switch(e){case"left":this.x-101<=0?this.x=0:this.x-=101;break;case"right":this.x+101>=404?this.x=404:this.x+=101;break;case"down":this.y+83>=390?this.y=390:this.y+=83;break;case"up":this.y-83<=-25?this.y=-25:this.y-=83}}},this.win=function(){this.suspended=!0,j.score+=200,j.level++,w("won"),this.animations.win.isPlaying=!0},this.winAnimation=function(e){this.scale>0?this.scale-=2*e:(this.animations.win.isPlaying=!1,this.finalizeWin())},this.finalizeWin=function(){this.reset(),C(),E(),k()},this.die=function(){this.suspended=!0,j.lives--,w("died"),this.animations.death.isPlaying=!0},this.deathAnimation=function(e){this.opacity-1*e>0&&this.scale>0?(this.opacity-=1*e,this.y-=50*e,this.scale-=.3*e):(this.animations.death.isPlaying=!1,this.finalizeDeath())},this.finalizeDeath=function(){j.lives<0?r():this.reset()},this.reset=function(){this.sprite=N.playerSprite,this.x=202,this.y=390,this.scale=1,this.opacity=1,this.suspended=!1}};U.prototype=Object.create(J.prototype),U.prototype.constructor=U;var K=function(){var e=["Blue","Green","Orange"],t=e[I.randomFromRange(0,2)],i="images/Gem "+t+".png",n=101*I.randomFromRange(0,4)+38,o=83*I.randomFromRange(1,3)+60;J.call(this,i,n,o),this.velocity=I.randomFromRange(15,35),this.points=50,Math.random()>.5&&(this.velocity=-this.velocity),this.render=function(){F.drawImage(Y.get(this.sprite),this.x,this.y,25,43)},this.update=function(e){this.idleAnimation(e),this.handleCollisions()},this.handleCollisions=function(){M.suspended||this.y-60===M.y+25&&n+50.5>M.x&&n-101<M.x&&(j.score+=this.points,w("collectablePickup"),this.destroy())},this.idleAnimation=function(e){this.x<n-8?(this.velocity=-this.velocity,this.x=n-8):this.x>n+8?(this.velocity=-this.velocity,this.x=n+8):this.x+=this.velocity*e},this.destroy=function(){var e=D.indexOf(this);D.splice(e,1)}};K.prototype=Object.create(J.prototype),K.prototype.constructor=K,P.addEventListener("keyup",c),P.addEventListener("touchend",g),P.addEventListener("touchstart",p),B.addEventListener("mousemove",u),B.addEventListener("mousedown",d),B.addEventListener("mouseup",f),l(),e.player=M,e.allEnemies=_,e.allCollectables=D,e.drawScore=o,e.drawLives=i,e.drawLevel=t,e.drawMenu=n,e.menus=H}(this);