!function(e){function t(e,t,r,i){function o(){i&&i(a(d)),s()}function a(e){var t=[];if("input"===e.tagName.toLowerCase()){var n={id:e.id,value:e.value,checked:e.checked};t.push(n)}else if(e.children.length)for(var r=0,i=e.children.length;r<i;r++)t=t.concat(a(e.children[r]));return t}function s(){document.body.removeChild(u),u=null,c=null,f=null,p=null,m=null}function l(){r(a(d)),s()}if("string"!=typeof e&&!n(e))throw new TypeError("Form message must be a String or DOM Element.");if("string"!=typeof t&&!n(t))throw new TypeError("Form inputs must be a String or DOM Element.");if("function"!=typeof r||null!=i&&"function"!=typeof i)throw new TypeError("Form callbacks must be functions (or optionally undefined in the case of the cancel callback).");var c=document.createElement("form");c.classList.add("util-fullpage-form");var u=document.createElement("div");u.classList.add("util-fullpage-form-overlay"),u.appendChild(c),"string"==typeof e?c.innerHTML=e:c.appendChild(e);var d=document.createElement("div");"string"==typeof t?d.innerHTML+=t:d.appendChild(t),c.appendChild(d);var f=document.createElement("div"),p=document.createElement("button"),m=document.createElement("button");p.type="button",m.type="button",p.onclick=l,m.onclick=o,p.textContent="Confirm",m.textContent="Cancel",f.appendChild(m),f.appendChild(p),c.appendChild(f),u.style.position="fixed",u.style.top="0",u.style.left="0",u.style.bottom="0",u.style.right="0",u.style.background="rgba(0,0,0,0.5)",u.style.padding="10px",u.style.display="flex",u.style["justify-content"]="center",u.style["align-items"]="center",u.style["flex-direction"]="column",u.style["text-align"]="center",u.style["z-index"]="999",c.style.background="white",c.style.border="solid 1px black",c.style.color="black",c.style.padding="10px",c.style["max-height"]="100%",c.style["overflow-y"]="scroll",f.style["margin-top"]="15px",m.style["margin-right"]="10px",document.body.appendChild(u)}function n(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}e.util={fullpageForm:t,isElement:n}}(this),function(e){function t(){if(r=e.jQuery,!r)throw new Error("jQuery not found.")}function n(e,t){function n(e){return e*(Math.PI/180)}if(!e||!t)return null;var r=6371,i=n(t.lat-e.lat),o=n(t.lng-e.lng),a=n(e.lat),s=n(t.lat),l=Math.sin(i/2)*Math.sin(i/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(a)*Math.cos(s),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),u=r*c;return u}var r,i={};i.flickr=function(e,t,n){var i={place:t,source:"flickr",results:[]};return"function"!=typeof e?void console.warn("No callback passed to `sources.flickr`."):t&&null!=t.lat&&null!=t.lng?(n=n||10,void r.ajax({url:"https://api.flickr.com/services/rest/",data:{method:"flickr.photos.search",api_key:"361633fa9bcc997bf3519b5cca2e6ceb",content_type:1,lat:t.lat,lon:t.lng,radius:10,per_page:n,format:"json",nojsoncallback:1},dataType:"json"}).done(function(e){if(e.photos){var t=e.photos.photo;t.forEach(function(e){var t={src:"https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg",url:"https://www.flickr.com/photos/{user-id}/{photo-id}",title:e.title};t.src=t.src.replace("{farm-id}",e.farm).replace("{server-id}",e.server).replace("{id}",e.id).replace("{secret}",e.secret),t.url=t.url.replace("{user-id}",e.owner).replace("{photo-id}",e.id),i.results.push(t)})}}).always(function(){e(i)})):(console.warn("Insufficient place details passed to `sources.flickr`."),void e(i))},i.foursquare=function(e,t,n){var i={place:t,source:"foursquare",results:[]};return"function"!=typeof e?void console.warn("No callback passed to `sources.foursquare`."):t&&null!=t.lat&&null!=t.lng?(n=n||5,void r.ajax({url:"https://api.foursquare.com/v2/venues/explore",data:{client_id:"0V0DM3MNMWFDECB2ZTPOAB1XIZD1F14VFCIBLGJ1RJQD2C3V",client_secret:"JHNX33ATTXI0QAEV0JG00GS1W14NGFWG0TT1XV4TTIBY1WDM",v:20160324,m:"foursquare",limit:n,ll:t.lat+","+t.lng,venuePhotos:1,sortByDistance:1},dataType:"json"}).done(function(e){if(e.response.groups)for(var t in e.response.groups)if(e.response.groups.hasOwnProperty(t)){t=e.response.groups[t];for(var n=0;n<t.items.length;n++)i.results.push(t.items[n].venue)}}).always(function(){e(i)})):(console.warn("Insufficient place details passed to `sources.foursquare`."),void e(i))},i.wikipedia=function(e,t,i){function o(e){var t,n;if(!e)return null;if(1===e.length)return{lat:e[0].lat,lng:e[0].lon};for(t=0,n=e.length;t<n;t++){if(e[t].primary)return{lat:e[t].lat,lng:e[t].lon};if(t===n-1)return{lat:e[0].lat,lng:e[0].lon}}}var a={place:t,source:"wikipedia",results:[]};return"function"!=typeof e?void console.warn("No callback passed to `sources.wikipedia`."):t&&null!=t.lat&&null!=t.lng?(i=i||{},i.limit=i.limit||5,i.maxDimension=i.maxDimension||144,void r.ajax({type:"GET",url:"https://en.wikipedia.org/w/api.php",data:{action:"query",format:"json",prop:"coordinates|pageimages|pageterms|info",generator:"geosearch",formatversion:2,colimit:i.limit,piprop:"thumbnail",pithumbsize:i.maxDimension,pilimit:i.limit,wbptterms:"description",inprop:"url",ggscoord:t.lat+"|"+t.lng,ggsradius:1e4,ggslimit:i.limit},dataType:"jsonp"}).done(function(e){e.query&&e.query.pages&&(a.results=e.query.pages.map(function(e){return{url:e.fullurl,coordinates:e.coordinates,lang:e.pagelanguage,thumbnail:e.thumbnail,title:e.title,description:e.terms?e.terms.description:void 0}}).reduce(function(e,r){for(var i=o(r.coordinates),a=n(t,i),s=0,l=e.length;s<l;s++){var c=o(e[s].coordinates),u=n(t,c);if(a<u||null==u&&null!=a){var d=e.indexOf(e[s]);e.splice(d,0,r);break}}return e.indexOf(r)===-1&&e.push(r),e},[]))}).always(function(){e(a)})):(console.warn("Insufficient place details passed to `sources.wikipedia`."),void e(a))},e.placeInfo={init:t,sources:i}}(this),function(e){function t(e){e.map=O,e.animation=M.maps.Animation.DROP,e.id=e.id.toString();var t=new M.maps.Marker(e);P.push(t)}function n(e){function t(){r.setAnimation(null)}var n=1.5,r=a(e);r.setAnimation(M.maps.Animation.BOUNCE),E.setTimeout(t,1e3*n)}function r(e){if(Array.isArray(e)){var t=new M.maps.LatLngBounds;e.forEach(function(e){t.extend(a(e).getPosition())}),O.fitBounds(t)}else{var n=a(e);O.panTo(n.getPosition())}b()}function i(){M.maps.event.trigger(A,"closeclick"),A.close()}function o(){return A.getContent()}function a(e){e=e.toString();for(var t=0;t<P.length;t++)if(P[t].id===e)return P[t];return null}function s(e,t,n){function r(t,n){n===M.maps.places.PlacesServiceStatus.OK&&c.results.push(i(t)),e(c)}function i(e){var t={};return t.address=e.formatted_address,t.phone=e.formatted_phone_number,t.internationalPhone=e.international_phone_number,t.attributions=e.html_attributions,t.icon=e.icon,t.name=e.name,t.photos=a(e.photos),t.price=s(e.price_level),t.rating=e.rating,t.reviews=l(e.reviews),t.types=e.types,t.googlePage=e.url,t.utcOffset=e.utc_offset,t.website=e.website,t}function o(e){if(Array.isArray(e))return e.map(function(e){return{type:e.type,rating:e.rating}})}function a(e){if(Array.isArray(e))return e.map(function(e){return{src:e.getUrl({maxHeight:n.maxHeight,maxWidth:n.maxWidth}),attributions:e.html_attributions,fullsize:e.getUrl({maxWidth:1600})}})}function s(e){switch(e){case 0:return"Free";case 1:return"Inexpensive";case 2:return"Moderately Expensive";case 3:return"Expensive";case 4:return"Very Expensive";default:return}}function l(e){if(Array.isArray(e))return e.map(function(e){return{aspects:o(e.aspects),author:{name:e.author_name,profile:e.author_url},language:e.language,text:e.text}})}var c={place:t,source:"google",results:[]};return"function"!=typeof e?void console.warn("No callback passed to `map.getPlaceDetails`."):null==t?(console.warn("No marker ID passed to `map.getPlaceDetails`."),void e(c)):(n=n||{maxWidth:300,maxHeight:300},void x.getDetails({placeId:t},r))}function l(){if(M=e.google,!M)throw new Error("Google Maps API not found.");if(!e._map)throw new Error("Google Map not initialized.");O=_map.map,x=_map.places,C=_map.searchBox,A=_map.infoWindow,u(b)}function c(e,t){var n=a(e);n?t.hasOwnProperty("visible")&&n.setVisible(t.visible):console.warn("Failed to modify marker because it wasn't found.")}function u(e){return O.addListener("bounds_changed",e)}function d(e){return A.addListener("closeclick",e)}function f(e){return O.addListener("dblclick",e)}function p(e,t){var n=a(e);return n.addListener("click",t)}function m(e){return C.addListener("places_changed",e)}function g(e){function t(){function e(){O.setOptions({scrollwheel:!0}),I.remove(),I=null}I||(I=A.addListener("closeclick",e),O.setOptions({scrollwheel:!1}))}var n=a(e),r=JSON.parse(F.getItem(T.MAPOPTIONS)),i=!r.hasOwnProperty("scrollwheel")||r.scrollwheel;i&&t(),A.open(O,n)}function h(){var e=JSON.parse(F.getItem(T.MAPOPTIONS));O.panTo(e.center)}function v(e){var t=a(e);t?(t.setMap(null),P.splice(P.indexOf(t),1)):console.warn("Failed to remove marker because it wasn't found.")}function b(){var e=JSON.parse(F.getItem(T.MAPOPTIONS));e.center=O.getCenter(),e.zoom=O.getZoom(),F.setItem(T.MAPOPTIONS,JSON.stringify(e))}function k(e){A.setContent(e)}function w(){M.maps.event.trigger(O,"resize")}function y(e){var t=a(e);return O.getBounds().contains(t.getPosition())}var M,O,x,C,A,I,E=(e.document,e.window),F=e.localStorage,T={MAPOPTIONS:"mapOptions"},P=[];e.map={addMarker:t,bounceMarker:n,centerOn:r,closeInfoWindow:i,getInfoWindowContent:o,getPlaceDetails:s,init:l,modifyMarker:c,onBoundsChange:u,onInfoWindowClose:d,onMapDblClick:f,onMarkerClick:p,onPlacesChanged:m,openInfoWindow:g,recenter:h,removeMarker:v,setInfoWindowContent:k,triggerResize:w,visibleOnMap:y}}(this),function(e){function t(){r=e.ko,i=!0}function n(e){i||t(),e=e||{},this.name=r.observable(e.name||"New Folder"),this.contents=r.observableArray(e.contents||[]),this.collapsed=r.observable(e.collapsed||!1),this.editing=r.observable(e.editing||!1),this.visible=r.observable(e.visible||!0)}var r,i=!1;e.models=e.models||{},e.models.Folder=n}(this),function(e){function t(){r=e.ko,i=e.UUID,o=!0}function n(e){o||t(),e=e||{},this.id=r.observable(e.id||i.generate()),this.description=r.observable(e.description||""),this.position=r.observable(e.position||{lat:0,lng:0}),this.title=r.observable(e.title||"New Marker"),this.selected=r.observable(e.selected||!1),this.visible=r.observable(e.visible||!0)}var r,i,o=!1;e.models=e.models||{},e.models.Marker=n}(this),function(e){function t(t){function n(e){a=e?d.toJS(s.marker()):null}function r(e){s.source()!==e&&(s.source(e),s.refresh())}function i(){s.editing()&&(s.restore(),s.editing(!1)),c.getInfoWindowContent().innerHTML="",s.marker(null)}function o(){c.onInfoWindowClose(i),s.editing.subscribe(n)}var a,s=this,l=e.document,c=e.map,u=e.placeInfo,d=e.ko,f={},p=1200,m=450;s.changeSourceTo={flickr:function(){r("flickr")},foursquare:function(){r("foursquare")},google:function(){r("google")},wikipedia:function(){r("wikipedia")}},s.close=function(){c.closeInfoWindow()},s.edit=function(){s.editing(!0)},s.editing=d.observable(!1),s.info=d.observable("<p>Loading...</p>"),s.marker=d.observable(),s.open=function(e){function t(){var e=l.createElement("div");e.classList.add("info-window");var t=l.createElement("article");t.dataset.bind="visible: !editing()",t.innerHTML='<div class="button-group"><button data-bind="click: edit">Modify</button><button data-bind="click: remove">Remove</button></div><h1 data-bind="text: marker().title"></h1><p data-bind="text: marker().description"></p><h2 class="additional-info-sources">Information Sources</h2><div class="button-group"><button data-bind="click: changeSourceTo.google, css: {\'selected-source\': source() === \'google\'}"><i class="fa fa-google"></i></button><button data-bind="click: changeSourceTo.flickr, css: {\'selected-source\': source() === \'flickr\'}"><i class="fa fa-flickr"></i></button><button data-bind="click: changeSourceTo.foursquare, css: {\'selected-source\': source() === \'foursquare\'}"><i class="fa fa-foursquare"></i></button><button data-bind="click: changeSourceTo.wikipedia, css: {\'selected-source\': source() === \'wikipedia\'}"><i class="fa fa-wikipedia-w"></i></button></div><section class="additional-info" data-bind="html: info"></section>';var n=l.createElement("form");return n.classList.add("additional-info-form"),n.dataset.bind="visible: editing, submit: update",n.innerHTML='<label>Title<input type="text" data-bind="textInput: marker().title"></label><label>Description<textarea data-bind="textInput: marker().description" rows="4"></textarea></label><div class="button-group"><button data-bind="click: restore" type="button">Cancel</button><button type="submit">Confirm</button></div>',e.appendChild(t),e.appendChild(n),e}s.marker()&&s.close();var n=t();s.marker(e),s.refresh(),c.setInfoWindowContent(n),c.openInfoWindow(e.id()),d.applyBindings(s,n)},s.refresh=function(){function e(e){var t="object"==typeof e.place?JSON.stringify(e.place):e.place;f[e.source]=f[e.source]||{},f[e.source][t]={info:e,timestamp:Date.now()}}function t(e,t){if(f[e]&&f[e][t]){var n=f[e][t],r=(Date.now()-n.timestamp)/1e3;if(r<p)return n}return!1}function n(e){function t(){switch(e.source){case"google":return"Details From Google";case"flickr":return"Area Photos From Flickr";case"foursquare":return"Nearby Venues From Foursquare";case"wikipedia":return"Area Articles From Wikipedia";default:return""}}function n(){if(!e.results.length)return"<p>Nothing found.</p>";switch(e.source){case"google":return e.results.map(function(e){return e.name=e.name.replace(/</g,"&lt;"),'<div class="additional-info-result google-result"><h2 class="google-result-title">'+(e.website?'<a href="'+e.website+'" target="_blank">'+e.name+"</a>":e.name)+'</h2><ul class="google-result-details">'+(e.address?'<li class="google-result-detail">'+e.address+"</li>":"")+(e.internationalPhone?'<li class="google-result-detail">'+e.internationalPhone+"</li>":"")+(e.price?'<li class="google-result-detail">'+e.price+"</li>":"")+(e.rating?'<li class="google-result-detail">'+e.rating+" / 5</li>":"")+(e.googlePage?'<li class="google-result-detail"><a href="'+e.googlePage+'" target="_blank">Google Page</a></li>':"")+"</ul>"+(e.photos?'<h3>Photos</h3><ul class="google-result-photos">'+e.photos.map(function(e){return'<li class="google-result-photo-container"><a href="'+e.fullsize+'" target="_blank"><img class="google-result-photo" src="'+e.src+'"></a><small>'+e.attributions.join(" ")+"</small></li>"}).join("")+"</ul>":"")+(e.reviews?'<h3>Reviews</h3><ul class="google-result-reviews">'+e.reviews.map(function(e){return'<li class="google-result-review">'+(e.author.profile?'<a href="'+e.author.profile+'" target="_blank">'+e.author.name.replace(/</g,"&lt;")+"</a>":e.author.name.replace(/</g,"&lt;"))+"<ul>"+e.aspects.map(function(e){return"<li>"+e.type+": "+e.rating+"/3</li>"}).join("")+"</ul><p>"+e.text+"</p></li>"}).join("")+"</ul>":"")+"</div>"}).join("");case"flickr":return e.results.map(function(e){return e.title=e.title.replace(/</g,"&lt;").replace(/#/g,"<wbr>#"),'<div class="additional-info-result flickr-result"><h2 class="flickr-result-title">'+e.title+'</h2><a href="'+e.url+'" target="_blank"><img class="flickr-result-photo" src="'+e.src+'"></a></div>'}).join("");case"foursquare":return e.results.map(function(e){return e.name=e.name.replace(/</g,"&lt;"),'<div class="additional-info-result foursquare-result"><h2 class="foursquare-result-title">'+(e.url?'<a href="'+e.url+'" target="_blank">'+e.name+"</a>":e.name)+'</h2><ul class="foursquare-result-details">'+(e.categories.length?'<li class="foursquare-result-detail">'+e.categories.filter(function(e){return!!e.hasOwnProperty("primary")})[0].name+"</li>":"")+(e.location.address?'<li class="foursquare-result-detail">'+e.location.address+"</li>":"")+(e.price?'<li class="foursquare-result-detail">Price: '+e.price.message+"</li>":"")+(e.rating?'<li class="foursquare-result-detail">'+e.rating+" / 10</li>":"")+'<li class="foursquare-result-detail"><a href="https://foursquare.com/v/'+e.id+'?ref=0V0DM3MNMWFDECB2ZTPOAB1XIZD1F14VFCIBLGJ1RJQD2C3V" target="_blank">More information...</a></li></ul></div>'}).join("");case"wikipedia":return e.results.map(function(e){return'<div class="additional-info-result wikipedia-result"><h2 class="wikipedia-result-title">'+(e.url?'<a href="'+e.url+'" target="_blank">'+e.title+"</a>":e.title)+"</h2>"+(e.thumbnail?'<img class="wikipedia-result-thumb" src="'+e.thumbnail.source+'">':"")+(e.description?'<p class="wikipedia-result-description">'+e.description+"</p>":"")+"</div>"}).join("");default:return""}}function r(){switch(e.source){case"google":return e.results.map(function(e){return e.attributions}).join(" ");case"flickr":return'Disclaimer: <q cite="https://www.flickr.com/services/api/tos/">This product uses the Flickr API but is not endorsed or certified by Flickr.</q>';case"foursquare":return'Results provided by <cite><a href="https://foursquare.com/">Foursquare</a></cite>.';case"wikipedia":return'Results provided by <cite><a href="https://www.wikipedia.org/">Wikipedia</a></cite>.';default:return""}}var i='<h1 class="additional-info-title">'+t()+'</h1><div class="additional-info-results">'+n()+'</div><footer class="additional-info-credit"><small>'+r()+"</small></footer>";return i}function r(t){if(t.results.length&&e(t),t.source===i&&(t.place===s.marker().id()||t.place===s.marker().position())){var r=n(t);s.info(r)}}var i=s.source(),o=s.marker().id(),a=s.marker().position(),l=t(i,"google"===i?o:JSON.stringify(a));if(s.info("<p>Loading...</p>"),!u&&"google"!==i){var d={place:a,source:i,results:[]};return void r(d)}if(l)r(l.info);else switch(i){case"google":c.getPlaceDetails(r,o,{maxWidth:m});break;case"flickr":u.sources.flickr(r,a);break;case"foursquare":u.sources.foursquare(r,a);break;case"wikipedia":u.sources.wikipedia(r,a,{maxDimension:m})}},s.remove=function(){var e=s.marker();s.close(),t.removeMarker(e)},s.restore=function(){return a?(s.marker().title(a.title),s.marker().description(a.description),void s.editing(!1)):(console.warn("Could not restore marker, no cached data found."),void s.editing(!1))},s.source=d.observable("google"),s.update=function(){s.editing(!1);var e=s.marker();s.close(),t.createOrRecreateMarker(e),s.open(e),t.saveMarkers()},o()}e.viewmodels=e.viewmodels||{},e.viewmodels.InfoWindow=t}(this),function(e){function t(t){function n(){u.visibleOnly()&&u.updateVisibility()}function r(e,t){do{if(a(e,t))return e;e=e.parentNode}while(e);return null}function i(){function e(){return d.innerWidth>=1e3}u.stayOpen(e()),u.expanded(e()),u.expanded()&&d.setTimeout(function(){p.triggerResize(),p.recenter()},500),d.addEventListener("resize",function(){u.stayOpen(e())}),o(),u.stayOpen.subscribe(o),u.visibleOnly.subscribe(u.updateVisibility),u.search.subscribe(u.updateVisibility),p.onBoundsChange(n)}function o(){function e(){d.setTimeout(function(){p.triggerResize(),p.recenter()},500)}u.stayOpen()?(l||(l=function(e){p.triggerResize(),p.recenter()},d.addEventListener("resize",l)),c||(c=u.expanded.subscribe(e))):(l&&(d.removeEventListener("resize",l,!1),l=null),c&&(c.dispose(),c=null))}function a(t,n){if(!t.tagName)return null;var r=e.document.documentElement,i=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector;return i.call(t,n)}function s(e,n){var r=t.getContainingArray(e),i=r(),o=i.indexOf(e);if(i.splice(o,1),n){var a=t.getAllMarkers(e.contents());a.forEach(function(e){t.removeMarker(e,!0)})}else{var s=i.splice(0,o-1);i=s.concat(e.contents(),i)}r(i),t.saveMarkers()}var l,c,u=this,d=(e.document,e.window),f=e.util,p=e.map,m=e.ko,g=e.models;u.addFolder=function(e){t.markers.push(new g.Folder({name:u.newFolderName()})),u.newFolderName(""),t.saveMarkers()},u.centerOnContents=function(e){var n=t.getAllMarkers(e.contents()).map(function(e){return e.id()});n.length&&(u.stayOpen()||u.expanded(!1),p.centerOn(n))},u.confirmDeleteAll=function(){function e(e){var n=t.markers().slice();n.forEach(function(e){e instanceof g.Folder?s(e,!0):t.removeMarker(e)})}var n="<h1>Warning!</h1><p>Are you sure you want to delete <strong>all</strong> markers and folders?</p><p><strong>This is an irreversible action.</strong></p>",r="";f.fullpageForm(n,r,e)},u.confirmFolderRemoval=function(e){function t(t){var n=t[0].checked;s(e,n)}var n="<p>Are you sure you want to remove the <i>"+e.name().replace(/</g,"&lt;")+"</i> folder?</p>",r='<label><input type="checkbox" value="removeContents"> Also remove the folder\'s contents.</label>';f.fullpageForm(n,r,t)},u.dragStart=function(e,t){var n=null!==r(t.target,".drag-handle");return!!n&&(e.item instanceof g.Folder&&!e.item.collapsed()&&u.toggleFolder(e.item),!0)},u.expanded=m.observable(!1),u.newFolderName=m.observable(""),u.reorder=function(e,n,r){function i(){var e=r.items.indexOf(r.item);n.items.remove(n.item),r.items.splice(e,0,n.item),n.items=r.items,t.saveMarkers()}function o(){n.items.remove(n.item),r.item.contents.push(n.item),n.items=r.item.contents,t.saveMarkers()}n.item!==r.item&&(r.item instanceof g.Folder&&!r.item.contents().length&&!r.item.collapsed()?o():i())},u.search=m.observable(""),u.stayOpen=m.observable(!1),u.toggle=function(){u.expanded(!u.expanded())},u.toggleFolder=function(e){e.collapsed(!e.collapsed()),e.collapsed()?u.updateVisibility(e.contents(),!1):u.updateVisibility(e.contents()),t.saveMarkers()},u.toggleFolderEditing=function(e){this.editing(!this.editing()),this.editing()||t.saveMarkers()},u.updateVisibility=function(e,n){function r(e,t){for(var n=0;n<e.length;n++)if(void 0!==t)e[n].visible()!==t&&(e[n].visible(t),e[n].contents||p.modifyMarker(e[n].id(),{visible:t})),e[n].contents&&r(e[n].contents(),t);else if(e[n].contents)e[n].visible()||e[n].visible(!0),e[n].collapsed()?r(e[n].contents(),!1):r(e[n].contents());else{var o;o=e[n].title().toLowerCase().indexOf(i)!==-1,u.visibleOnly()&&o&&(o=p.visibleOnMap(e[n].id())),e[n].visible()!==o&&(e[n].visible(o),p.modifyMarker(e[n].id(),{visible:o}))}}var i=u.search().toLowerCase();u.visibleOnly();Array.isArray(e)||(e=t.markers()),r(e,n)},u.visibleOnly=m.observable(!1),i()}e.viewmodels=e.viewmodels||{},e.viewmodels.Sidebar=t}(this),function(e){function t(t){function n(){var e=l.pending().slice();e.forEach(function(e){t.removeMarker(e)})}function r(){d.forEach(function(e){e.subscription.dispose()}),d=[]}function i(){l.visible()&&l.visible(!1)}function o(){l.pending.subscribe(a)}function a(e){if(!e.length)return r(),void i();var t=d.map(function(e){return e.id});e.forEach(function(e){t.indexOf(e.id())===-1&&d.push({id:e.id(),subscription:e.visible.subscribe(function(t){s(e.id(),t)})})})}function s(e,t){c.modifyMarker(e,{visible:t})}var l=this,c=e.map,u=e.ko,d=[];l.cancel=function(){i(),n(),r()},l.open=function(){l.visible()||l.visible(!0)},l.pending=u.observableArray([]),l.submit=function(){i(),l.pending(l.pending().filter(function(e){return!e.visible()||(t.markers.push(e),!1)})),n(),r(),t.saveMarkers()},l.visible=u.observable(!1),o()}e.viewmodels=e.viewmodels||{},e.viewmodels.MarkersForm=t}(this),function(e){function t(){function t(e){var t=s.createOrRecreateMarker({position:{lat:e.latLng.lat(),lng:e.latLng.lng()}});s.markers.push(t),s.saveMarkers(),s.infoWindow.open(t),s.infoWindow.edit()}function n(e){e.contents=r(e.contents);var t=new p.Folder(e);return t}function r(e){var t=[];return e.forEach(function(e){e.contents?t.push(n(e)):t.push(s.createOrRecreateMarker(e))}),t}function i(){var e=JSON.parse(l.getItem(c.MARKERS))||u.markers;s.markersForm=new m.MarkersForm(s),s.sidebar=new m.Sidebar(s),s.infoWindow=new m.InfoWindow(s),e.forEach(function(e){if(e.contents){var t=n(e);s.markers.push(t)}else{var r=s.createOrRecreateMarker(e);s.markers.push(r)}}),s.sidebar.updateVisibility(),d.onPlacesChanged(o),d.onMapDblClick(t),s.infoWindow.marker.subscribe(a)}function o(){var e=this.getPlaces();e.forEach(function(e){var t=s.createOrRecreateMarker({id:e.place_id,title:e.name,position:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}});s.markersForm.pending.push(t)}),s.markersForm.open()}function a(e){function t(){s.getAllMarkers(s.markers()).concat(s.getAllMarkers(s.markersForm.pending())).forEach(function(e){e.selected()&&e.selected(!1)})}t(),e&&e.selected(!0)}var s=this,l=(e.document,e.localStorage),c={MARKERS:"markers"},u={markers:[{title:"Times Square",id:"ChIJmQJIxlVYwokRLgeuocVOGVU",position:{lat:40.758895,lng:-73.98513100000002}},{title:"New York Public Library - Stephen A. Schwarzman Building",id:"ChIJqaiomQBZwokRTHOaUG7fUTs",position:{lat:40.75318230000001,lng:-73.98225339999999}},{name:"Museums",contents:[{title:"The Metropolitan Museum of Art",id:"ChIJb8Jg9pZYwokR-qHGtvSkLzs",position:{lat:40.7794366,lng:-73.96324400000003}},{title:"The Museum of Modern Art",id:"ChIJKxDbe_lYwokRVf__s8CPn-o",position:{lat:40.7614327,lng:-73.97762160000002}},{title:"American Museum of Natural History",id:"ChIJCXoPsPRYwokRsV1MYnKBfaI",position:{lat:40.78132409999999,lng:-73.97398820000001}}]}]},d=e.map,f=e.ko,p=e.models,m=e.viewmodels;s.createOrRecreateMarker=function(e){e instanceof p.Marker?s.removeMarker(e.id(),!0):e=new p.Marker(e);var t=f.toJS(e);return d.addMarker(t),d.onMarkerClick(t.id,function(){s.markerClicked(e)}),e},s.getAllMarkers=function(e){var t=[];return e.forEach(function(e){if(e=f.unwrap(e),e instanceof p.Marker)t.push(e);else if(Array.isArray(e))t=t.concat(s.getAllMarkers(e));else if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&(n=f.unwrap(e[n]),Array.isArray(n)?t=t.concat(s.getAllMarkers(n)):n instanceof p.Marker&&t.push(n))}),t},s.getContainingArray=function(e){function t(n){var r,i,o,a,s=[];for(i=0;i<n.length;i++)for(r=n[i],o=0,a=r().length;o<a;o++)if(r()[o].contents){if(r()[o]===e)return r;s.push(r()[o].contents)}else if(r()[o]===e)return r;return s.length?t(s):null}return t([s.markers,s.markersForm.pending])},s.getMarker=function(e){function t(n){var r=[];n.length&&n[0].marker&&(n=n.map(function(e){return e.marker}));for(var i=0;i<n.length;i++)if(n[i].contents)for(var o=n[i].contents(),a=0;a<o.length;a++)r.push(o[a]);else if(n[i].id().toString()===e)return n[i];return r.length?t(r):null}return e=e.toString(),t(s.markers())||t(s.markersForm.pending())},s.infoWindow=null,s.markerClicked=function(e){s.sidebar.stayOpen()||s.sidebar.expanded(!1),d.bounceMarker(e.id()),d.centerOn(e.id()),s.infoWindow.open(e)},s.markers=f.observableArray([]),s.markersForm=null,s.removeMarker=function(e,t){if(e instanceof p.Marker||(e=s.getMarker(e)),s.infoWindow.marker()&&s.infoWindow.marker().id()===e.id()&&s.infoWindow.close(),!t){var n,r=s.getContainingArray(e),i=r();n=i.indexOf(e),i.splice(n,1),r(i),s.saveMarkers()}d.removeMarker(e.id())},s.saveMarkers=function(){l.setItem(c.MARKERS,f.toJSON(s.markers))},s.sidebar=null,i()}e.viewmodels=e.viewmodels||{},e.viewmodels.Main=t}(this),function(e){function t(){var t=e.window,n=e.document,r=e.map,i=e.placeInfo,o=e.ko,a=e.viewmodels;e.components;try{i.init()}catch(s){console.warn(s.name,":",s.message),i=null}try{r.init()}catch(s){return console.error(s.name,":",s.message),n.body.classList.remove("loading"),void(n.body.innerHTML='<div class="fullpage-error"><h1>Error</h1><p>'+s.message+'</p><ol><li>Are you connected to the internet?</li><li>Are you able to reach <a href="https://www.google.com">www.google.com</a>?</li><li>Is it possible that something on your end is blocking requests to maps.googleapis.com?</li></ol></div>')}o.applyBindings(new a.Main),t.setTimeout(function(){n.body.classList.remove("loading")},500)}e.window.addEventListener("load",t)}(this);